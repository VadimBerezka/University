USE Ber_MyBase;

-- 1. выводит количество заказов, максимум, минимум, среднее и сумму заказанных деталей для каждого клиента.
SELECT ZC.Имя_заказчика,
    COUNT(Z.ID_заказа) AS [количество заказов],
    MAX(Z.Количество_заказанных_деталей) AS [максимум],
    MIN(Z.Количество_заказанных_деталей) AS [минимум],
    AVG(Z.Количество_заказанных_деталей) AS [среднее],
    SUM(Z.Количество_заказанных_деталей) AS [сумма]
FROM ЗАКАЗ Z INNER JOIN ЗАКАЗЧИК ZC ON Z.ID_заказчика = ZC.ID_заказчика
GROUP BY ZC.Имя_заказчика;

-- 2. показывает, сколько деталей поставляет каждый поставщик.
SELECT PS.Название AS [поставщик],
    COUNT(S.ID_детали) AS [количество деталей]
FROM ПОСТАВЩИК PS LEFT JOIN СКЛАД S ON PS.ID_поставщика = S.ID_поставщика
GROUP BY PS.Название;

-- 3. вычисляет среднюю цену товаров для каждого поставщика и сортирует по убыванию.
SELECT PS.Название AS [поставщик],
    ROUND(AVG(S.Цена), 2) AS [средняя цена]
FROM ПОСТАВЩИК PS INNER JOIN СКЛАД S ON PS.ID_поставщика = S.ID_поставщика
GROUP BY PS.Название
ORDER BY [средняя цена] DESC;

-- 4. показывает общее количество заказанных деталей для каждого наименования товара.
SELECT S.Название_детали,
    SUM(Z.Количество_заказанных_деталей) AS [количество заказанных]
FROM ЗАКАЗ Z INNER JOIN СКЛАД S ON Z.ID_детали = S.ID_детали
GROUP BY S.Название_детали
ORDER BY [количество заказанных] DESC;

-- 5. выводит количество заказов и сумму заказанных деталей за каждую дату.
SELECT ZC.Дата_заказа,
    COUNT(Z.ID_заказа) AS [количество заказов],
    SUM(Z.Количество_заказанных_деталей) AS [сумма деталей]
FROM ЗАКАЗ Z INNER JOIN ЗАКАЗЧИК ZC ON Z.ID_заказчика = ZC.ID_заказчика
GROUP BY ZC.Дата_заказа
ORDER BY ZC.Дата_заказа DESC;